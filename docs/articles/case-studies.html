<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case Studies • LEMMA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Case Studies">
<meta property="og:description" content="LEMMA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LEMMA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/case-studies.html">Case Studies</a>
    </li>
    <li>
      <a href="../articles/faq.html">LEMMA FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LocalEpi/LEMMA/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Case Studies</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LocalEpi/LEMMA/blob/master/vignettes/case-studies.Rmd"><code>vignettes/case-studies.Rmd</code></a></small>
      <div class="hidden name"><code>case-studies.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">LEMMA</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">data.table</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)</pre></body></html></div>
<p>In these Case Studies we show how to use LEMMA to model COVID-19 hospitalizations in two counties. In San Francisco, LEMMA fits the data fairly easily. In Alameda County, more user intervention is required for LEMMA to fit the data.</p>
<div id="san-francisco" class="section level1">
<h1 class="hasAnchor">
<a href="#san-francisco" class="anchor"></a>San Francisco</h1>
<ol style="list-style-type: decimal">
<li><p>Get raw data. It would be better to automate this, but to keep things simple in this example, we exported as csv from <a href="https://data.sfgov.org/COVID-19/COVID-19-Hospitalizations/nxjg-bhem" class="uri">https://data.sfgov.org/COVID-19/COVID-19-Hospitalizations/nxjg-bhem</a>. This is COVID-19_Hospitalizations_SFMay6.csv.</p></li>
<li><p>Estimate Hospitilization Data bounds <code>LEMMA</code> needs lower and upper bounds on the <em>true</em> number of people hospitalized with COVID-19 on each day. In other words, if all hospital patients in San Francisco were given a perfect COVID-19 test on Day <span class="math inline">\(X\)</span>, how many would test positive for COVID-19? San Francisco has number of confirmed COVID+ and PUI (persons under investigation - suspected COVID-19). We currently assume a lower bound of 100% of confirmed and an upper bound of 100% of confirmed + 30% of PUI (adding together DPHCategory = Med/Surg and DPHCategory = ICU).</p></li>
</ol>
<p>A quick overview of the data:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html">fread</a></span>(<span class="st">"COVID-19_Hospitalizations_SFMay6.csv"</span>)
<span class="no">dt</span>[, <span class="no">date</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">reportDate</span>)]
<span class="no">dt</span>[, <span class="fu">.</span>(<span class="kw">meanAcrossDays</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">PatientCount</span>)), <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Hospital"</span>, <span class="st">"DPHCategory"</span>, <span class="st">"CovidStatus"</span>)]
<span class="co">#&gt;            Hospital DPHCategory CovidStatus meanAcrossDays</span>
<span class="co">#&gt; 1: All SF Hospitals    Med/Surg      COVID+       47.64444</span>
<span class="co">#&gt; 2: All SF Hospitals         ICU      COVID+       28.06667</span>
<span class="co">#&gt; 3: All SF Hospitals    Med/Surg         PUI       44.26667</span>
<span class="co">#&gt; 4: All SF Hospitals         ICU         PUI        8.00000</span></pre></body></html></div>
<p>Calculate bounds:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">dt</span>[<span class="no">CovidStatus</span> <span class="kw">==</span> <span class="st">"COVID+"</span>, <span class="no">mult.low</span> <span class="kw">:=</span> <span class="fl">1</span>]
<span class="no">dt</span>[<span class="no">CovidStatus</span> <span class="kw">==</span> <span class="st">"COVID+"</span>, <span class="no">mult.high</span> <span class="kw">:=</span> <span class="fl">1</span>]
<span class="no">dt</span>[<span class="no">CovidStatus</span> <span class="kw">==</span> <span class="st">"PUI"</span>, <span class="no">mult.low</span> <span class="kw">:=</span> <span class="fl">0</span>]
<span class="no">dt</span>[<span class="no">CovidStatus</span> <span class="kw">==</span> <span class="st">"PUI"</span>, <span class="no">mult.high</span> <span class="kw">:=</span> <span class="fl">0.3</span>]

<span class="no">hosp.bounds</span> <span class="kw">&lt;-</span> <span class="no">dt</span>[, <span class="fu">.</span>(<span class="kw">LowerBound</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PatientCount</span> * <span class="no">mult.low</span>),
                      <span class="kw">UpperBound</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PatientCount</span> * <span class="no">mult.high</span>)), <span class="kw">by</span><span class="kw">=</span><span class="no">date</span>]
<span class="no">hosp.bounds</span>
<span class="co">#&gt;           date LowerBound UpperBound</span>
<span class="co">#&gt;  1: 2020-03-23         26       62.6</span>
<span class="co">#&gt;  2: 2020-03-24         35       68.3</span>
<span class="co">#&gt;  3: 2020-03-25         40       62.2</span>
<span class="co">#&gt;  4: 2020-03-26         41       65.0</span>
<span class="co">#&gt;  5: 2020-03-27         52       75.7</span>
<span class="co">#&gt;  6: 2020-03-28         53       76.7</span>
<span class="co">#&gt;  7: 2020-03-29         58       81.1</span>
<span class="co">#&gt;  8: 2020-03-30         29       38.9</span>
<span class="co">#&gt;  9: 2020-03-31         57       69.6</span>
<span class="co">#&gt; 10: 2020-04-01         79      103.9</span>
<span class="co">#&gt; 11: 2020-04-02         76       92.2</span>
<span class="co">#&gt; 12: 2020-04-03         69       79.2</span>
<span class="co">#&gt; 13: 2020-04-04         68       84.8</span>
<span class="co">#&gt; 14: 2020-04-05         82      118.6</span>
<span class="co">#&gt; 15: 2020-04-06         93      128.7</span>
<span class="co">#&gt; 16: 2020-04-07         91      107.8</span>
<span class="co">#&gt; 17: 2020-04-08         89      105.2</span>
<span class="co">#&gt; 18: 2020-04-09         86       98.0</span>
<span class="co">#&gt; 19: 2020-04-10         83       94.7</span>
<span class="co">#&gt; 20: 2020-04-11         94      104.5</span>
<span class="co">#&gt; 21: 2020-04-12         90      102.6</span>
<span class="co">#&gt; 22: 2020-04-13         88      100.9</span>
<span class="co">#&gt; 23: 2020-04-14         88      113.8</span>
<span class="co">#&gt; 24: 2020-04-15         89      100.4</span>
<span class="co">#&gt; 25: 2020-04-16         84       94.5</span>
<span class="co">#&gt; 26: 2020-04-17         77       85.1</span>
<span class="co">#&gt; 27: 2020-04-18         78       88.8</span>
<span class="co">#&gt; 28: 2020-04-19         84       93.6</span>
<span class="co">#&gt; 29: 2020-04-20         81       94.8</span>
<span class="co">#&gt; 30: 2020-04-21         80       88.4</span>
<span class="co">#&gt; 31: 2020-04-22         82       90.4</span>
<span class="co">#&gt; 32: 2020-04-23         77       84.5</span>
<span class="co">#&gt; 33: 2020-04-24         78       84.6</span>
<span class="co">#&gt; 34: 2020-04-25         85       97.6</span>
<span class="co">#&gt; 35: 2020-04-26         87      111.9</span>
<span class="co">#&gt; 36: 2020-04-27         89      100.7</span>
<span class="co">#&gt; 37: 2020-04-28         84       92.4</span>
<span class="co">#&gt; 38: 2020-04-29         90       96.6</span>
<span class="co">#&gt; 39: 2020-04-30         90       96.0</span>
<span class="co">#&gt; 40: 2020-05-01         87       95.7</span>
<span class="co">#&gt; 41: 2020-05-02         90       96.0</span>
<span class="co">#&gt; 42: 2020-05-03         86       91.1</span>
<span class="co">#&gt; 43: 2020-05-04         84       87.9</span>
<span class="co">#&gt; 44: 2020-05-05         80       90.8</span>
<span class="co">#&gt; 45: 2020-05-06         78      115.8</span>
<span class="co">#&gt;           date LowerBound UpperBound</span></pre></body></html></div>
<p>There may be some data quality problems in March 30 - April 4:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">hosp.bounds</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">LowerBound</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">UpperBound</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ylab</a></span>(<span class="st">"Hospitalizations"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>At this point we would suggest investigating this data further with your DPH. For this vignette, we will omit the days March 30, March 31, April 3, April 4.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">hosp.bounds</span> <span class="kw">&lt;-</span>
  <span class="no">hosp.bounds</span>[!<span class="no">date</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2020-03-30"</span>, <span class="st">"2020-03-31"</span>, <span class="st">"2020-04-03"</span>, <span class="st">"2020-04-04"</span>))]</pre></body></html></div>
<p>Open the template Excel file (the original is <code><a href="https://rdrr.io/r/base/system.file.html">system.file("extdata", "SF-April13.xlsx", package = "LEMMA")</a></code> but the installation instructions on GitHub suggest copying it to example.xlsx in your local directory). In Excel, Save As as “SF-May4.xlsx”.</p>
<p>Copy and paste the bounds to the Hospitilization Data tab.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="no">hosp.bounds</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">col.names</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="co">#&gt; 2020-03-23,26,62.6</span>
<span class="co">#&gt; 2020-03-24,35,68.3</span>
<span class="co">#&gt; 2020-03-25,40,62.2</span>
<span class="co">#&gt; 2020-03-26,41,65</span>
<span class="co">#&gt; 2020-03-27,52,75.7</span>
<span class="co">#&gt; 2020-03-28,53,76.7</span>
<span class="co">#&gt; 2020-03-29,58,81.1</span>
<span class="co">#&gt; 2020-04-01,79,103.9</span>
<span class="co">#&gt; 2020-04-02,76,92.2</span>
<span class="co">#&gt; 2020-04-05,82,118.6</span>
<span class="co">#&gt; 2020-04-06,93,128.7</span>
<span class="co">#&gt; 2020-04-07,91,107.8</span>
<span class="co">#&gt; 2020-04-08,89,105.2</span>
<span class="co">#&gt; 2020-04-09,86,98</span>
<span class="co">#&gt; 2020-04-10,83,94.7</span>
<span class="co">#&gt; 2020-04-11,94,104.5</span>
<span class="co">#&gt; 2020-04-12,90,102.6</span>
<span class="co">#&gt; 2020-04-13,88,100.9</span>
<span class="co">#&gt; 2020-04-14,88,113.8</span>
<span class="co">#&gt; 2020-04-15,89,100.4</span>
<span class="co">#&gt; 2020-04-16,84,94.5</span>
<span class="co">#&gt; 2020-04-17,77,85.1</span>
<span class="co">#&gt; 2020-04-18,78,88.8</span>
<span class="co">#&gt; 2020-04-19,84,93.6</span>
<span class="co">#&gt; 2020-04-20,81,94.8</span>
<span class="co">#&gt; 2020-04-21,80,88.4</span>
<span class="co">#&gt; 2020-04-22,82,90.4</span>
<span class="co">#&gt; 2020-04-23,77,84.5</span>
<span class="co">#&gt; 2020-04-24,78,84.6</span>
<span class="co">#&gt; 2020-04-25,85,97.6</span>
<span class="co">#&gt; 2020-04-26,87,111.9</span>
<span class="co">#&gt; 2020-04-27,89,100.7</span>
<span class="co">#&gt; 2020-04-28,84,92.4</span>
<span class="co">#&gt; 2020-04-29,90,96.6</span>
<span class="co">#&gt; 2020-04-30,90,96</span>
<span class="co">#&gt; 2020-05-01,87,95.7</span>
<span class="co">#&gt; 2020-05-02,90,96</span>
<span class="co">#&gt; 2020-05-03,86,91.1</span>
<span class="co">#&gt; 2020-05-04,84,87.9</span>
<span class="co">#&gt; 2020-05-05,80,90.8</span>
<span class="co">#&gt; 2020-05-06,78,115.8</span></pre></body></html></div>
<ol start="3" style="list-style-type: decimal">
<li>Choose your prior distributions in the Parameters with Distributions tab. These should reflect your prior knowledge, based on available research and local information. The values in the template file reflect our knowledge as of April 13 about San Francisco. We later learned that Percent of Hospitalized COVID-19 Patients That are Currently in the ICU should be lower - we changed it to 32% 34% 36% 39% 41%</li>
</ol>
<p>Save the Excel file.</p>
<ol start="4" style="list-style-type: decimal">
<li>Run CredibilityIntervalFromExcel (takes 1-2 minutes)</li>
</ol>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"SF-May6.xlsx"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<p>The projection fits the data reasonably well, but we have only 361 posterior distributions. We recommend at least 1000 for inference. On the Internal sheet, change <code>main.iterations</code> to 35000. Save As “SF-May 6-v2.xlsx”</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"SF-May6-v2.xlsx"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
</div>
<div id="modelling-future-changes-in-transmission" class="section level1">
<h1 class="hasAnchor">
<a href="#modelling-future-changes-in-transmission" class="anchor"></a>Modelling Future Changes in Transmission</h1>
<p>Future changes in public health interventions (for example, relaxing/replacing current Shelter In Place ordinances) can be modelled as a future intervention which multiplies Re by a factor greater than 1. This is already set in the existing xlsx inputs. Below shows the effect of the third intervention which multiplies Re by 1.1 to 2 (C19:G19 in SF-May4.xlsx) on June 1.</p>
<p><img src="case-studies_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
</div>
<div id="alameda-county" class="section level1">
<h1 class="hasAnchor">
<a href="#alameda-county" class="anchor"></a>Alameda County</h1>
<ol style="list-style-type: decimal">
<li>Get the raw data: <a href="https://data.acgov.org/datasets/AC-HCSA" class="uri">https://data.acgov.org/datasets/AC-HCSA</a>::alameda-county-covid-19-hospitalizations As above, it would be better to automate this, but for this example we exported as Alameda_County_COVID-19_HospitalizationsMay4.csv</li>
</ol>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html">fread</a></span>(<span class="st">"Alameda_County_COVID-19_HospitalizationsMay4.csv"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dt</span>)
<span class="co">#&gt;      Date Hospitalized_COVID_19_Positive_ ICU_COVID_19_Positive_Patients</span>
<span class="co">#&gt; 1: 4/1/20                              52                             27</span>
<span class="co">#&gt; 2: 4/2/20                              57                             29</span>
<span class="co">#&gt; 3: 4/3/20                              64                             32</span>
<span class="co">#&gt; 4: 4/4/20                              60                             35</span>
<span class="co">#&gt; 5: 4/5/20                              72                             39</span>
<span class="co">#&gt; 6: 4/6/20                              79                             43</span>
<span class="co">#&gt;    Hospitalized_COVID_19_Positive1 ObjectId</span>
<span class="co">#&gt; 1:                              25        1</span>
<span class="co">#&gt; 2:                              28        2</span>
<span class="co">#&gt; 3:                              32        3</span>
<span class="co">#&gt; 4:                              25        4</span>
<span class="co">#&gt; 5:                              33        5</span>
<span class="co">#&gt; 6:                              36        6</span></pre></body></html></div>
<ol start="2" style="list-style-type: decimal">
<li>Estimate Hospitilization Data bounds Alameda County does not appear to have public PUI data. We will use the number of confirmed cases at the LowerBound.</li>
</ol>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">hosp.bounds</span> <span class="kw">&lt;-</span> <span class="no">dt</span>[, <span class="fu">.</span>(<span class="kw">date</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">Date</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"%m/%d/%y"</span>), <span class="kw">LowerBound</span> <span class="kw">=</span> <span class="no">Hospitalized_COVID_19_Positive_</span>)]</pre></body></html></div>
<p>The data looks somewhat noisy.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">hosp.bounds</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">date</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">LowerBound</span>)) + <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span>()</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
<p>Let’s see what happens if we use it as-is.</p>
<p>In San Francisco, the UpperBound is roughly 115% of the LowerBound, so we could use than as a first approximation.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">hosp.bounds</span>[, <span class="no">UpperBound</span> <span class="kw">:=</span> <span class="no">LowerBound</span> * <span class="fl">1.15</span>]
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">hosp.bounds</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>)) + <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">LowerBound</span>)) + <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">UpperBound</span>)) + <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ylab</a></span>(<span class="st">"Hospitalizations"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-17-1.png" width="768"></p>
<p>Open the template Excel file. In Excel, Save As as “Alameda-May4-v1.xlsx”.</p>
<p>On the Model Inputs sheet, change Number of People in Area to 1671000</p>
<p>Copy and paste the bounds to the Hospitilization Data tab.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="no">hosp.bounds</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">col.names</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="co">#&gt; 2020-04-01,52,59.8</span>
<span class="co">#&gt; 2020-04-02,57,65.55</span>
<span class="co">#&gt; 2020-04-03,64,73.6</span>
<span class="co">#&gt; 2020-04-04,60,69</span>
<span class="co">#&gt; 2020-04-05,72,82.8</span>
<span class="co">#&gt; 2020-04-06,79,90.85</span>
<span class="co">#&gt; 2020-04-07,76,87.4</span>
<span class="co">#&gt; 2020-04-08,84,96.6</span>
<span class="co">#&gt; 2020-04-09,80,92</span>
<span class="co">#&gt; 2020-04-10,93,106.95</span>
<span class="co">#&gt; 2020-04-11,87,100.05</span>
<span class="co">#&gt; 2020-04-12,91,104.65</span>
<span class="co">#&gt; 2020-04-13,85,97.75</span>
<span class="co">#&gt; 2020-04-14,92,105.8</span>
<span class="co">#&gt; 2020-04-15,81,93.15</span>
<span class="co">#&gt; 2020-04-16,73,83.95</span>
<span class="co">#&gt; 2020-04-17,85,97.75</span>
<span class="co">#&gt; 2020-04-18,82,94.3</span>
<span class="co">#&gt; 2020-04-19,84,96.6</span>
<span class="co">#&gt; 2020-04-20,85,97.75</span>
<span class="co">#&gt; 2020-04-21,85,97.75</span>
<span class="co">#&gt; 2020-04-22,84,96.6</span>
<span class="co">#&gt; 2020-04-23,81,93.15</span>
<span class="co">#&gt; 2020-04-24,79,90.85</span>
<span class="co">#&gt; 2020-04-25,83,95.45</span>
<span class="co">#&gt; 2020-04-26,84,96.6</span>
<span class="co">#&gt; 2020-04-27,81,93.15</span>
<span class="co">#&gt; 2020-04-28,76,87.4</span>
<span class="co">#&gt; 2020-04-29,76,87.4</span>
<span class="co">#&gt; 2020-04-30,74,85.1</span>
<span class="co">#&gt; 2020-05-01,75,86.25</span>
<span class="co">#&gt; 2020-05-02,73,83.95</span>
<span class="co">#&gt; 2020-05-03,73,83.95</span></pre></body></html></div>
<ol start="3" style="list-style-type: decimal">
<li><p>Choose your prior distributions in the Parameters with Distributions tab. As an example, let’s use the numbers in the template.</p></li>
<li><p>Run CredibilityIntervalFromExcel</p></li>
</ol>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v1.xlsx"</span>)</pre></body></html></div>
<p>Note that the “User’s Prior Projection” scenario is not compatible with the given bounds. A projection using <em>only</em> the priors that we specified in Column E of “Alameda-May4-v1.xlsx” do not fall within our bounds on some days. See <a href="https://localepi.github.io/LEMMA/articles/faq.html">FAQ.md</a> for more details on exactly what this means.</p>
<ol start="5" style="list-style-type: decimal">
<li>Examine the .pdf and/or .xlsx output.</li>
</ol>
<p><img src="case-studies_files/figure-html/unnamed-chunk-20-1.png" width="768"></p>
<p>The first page of the .pdf says we have 0 iterations. Obviously we need to make some changes.</p>
<p>The April 16 data is clearly an outlier. Delete that row in Excel.</p>
<p>Save As Alameda-May4-v2.xlsx.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v2.xlsx"</span>)</pre></body></html></div>
<p>Running CredibilityIntervalFromExcel still gives 0 iterations.</p>
<p><img src="case-studies_files/figure-html/unnamed-chunk-22-1.png" width="768"></p>
<ol start="6" style="list-style-type: decimal">
<li>Try smoothing the data. We use loess with span = 0.4 but other smoothing procedures could be used.</li>
</ol>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">hosp.bounds</span> <span class="kw">&lt;-</span> <span class="no">hosp.bounds</span>[<span class="no">date</span> <span class="kw">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2020-04-16"</span>)]
<span class="no">hosp.bounds</span>[, <span class="no">orig.lower</span> <span class="kw">:=</span> <span class="no">LowerBound</span>]
<span class="no">hosp.bounds</span>[, <span class="no">orig.upper</span> <span class="kw">:=</span> <span class="no">UpperBound</span>]
<span class="no">hosp.bounds</span>[, <span class="no">date.index</span> <span class="kw">:=</span> <span class="fl">1</span>:<span class="no">.N</span>]
<span class="no">m1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span>(<span class="no">LowerBound</span> ~ <span class="no">date.index</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">hosp.bounds</span>, <span class="kw">span</span> <span class="kw">=</span> <span class="fl">0.4</span>)
<span class="no">hosp.bounds</span>$<span class="no">LowerBound</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">m1</span>)
<span class="no">hosp.bounds</span>[, <span class="no">UpperBound</span> <span class="kw">:=</span> <span class="no">LowerBound</span> * <span class="fl">1.15</span>]

<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">hosp.bounds</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">LowerBound</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">UpperBound</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">orig.upper</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="st">"Upper Bound"</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">orig.lower</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="st">"Lower Bound"</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-23-1.png" width="768"></p>
<p>Copy and paste the bounds to the Hospitilization Data tab.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="no">hosp.bounds</span>[, <span class="fu">.</span>(<span class="no">date</span>, <span class="no">LowerBound</span>, <span class="no">UpperBound</span>)],
            <span class="kw">sep</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">col.names</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="co">#&gt; 2020-04-01,51.8832100479336,59.6656915551236</span>
<span class="co">#&gt; 2020-04-02,56.8656337161158,65.3954787735331</span>
<span class="co">#&gt; 2020-04-03,61.6836235450605,70.9361670768195</span>
<span class="co">#&gt; 2020-04-04,66.2661963266626,76.206125775662</span>
<span class="co">#&gt; 2020-04-05,70.6055708802349,81.1964065122702</span>
<span class="co">#&gt; 2020-04-06,74.6986166982751,85.9034092030164</span>
<span class="co">#&gt; 2020-04-07,78.8235965067849,90.6471359828027</span>
<span class="co">#&gt; 2020-04-08,82.5039201267141,94.8795081457212</span>
<span class="co">#&gt; 2020-04-09,85.2057746641351,97.9866408637554</span>
<span class="co">#&gt; 2020-04-10,87.1980945186538,100.277808696452</span>
<span class="co">#&gt; 2020-04-11,88.6691138013258,101.969480871525</span>
<span class="co">#&gt; 2020-04-12,89.3486444947334,102.750941168943</span>
<span class="co">#&gt; 2020-04-13,88.2526493524055,101.490546755266</span>
<span class="co">#&gt; 2020-04-14,86.6398958063131,99.63588017726</span>
<span class="co">#&gt; 2020-04-15,85.2359394345269,98.0213303497059</span>
<span class="co">#&gt; 2020-04-17,84.0066495413416,96.6076469725428</span>
<span class="co">#&gt; 2020-04-18,83.8374332435815,96.4130482301187</span>
<span class="co">#&gt; 2020-04-19,83.8650557177177,96.4448140753753</span>
<span class="co">#&gt; 2020-04-20,83.8966648374278,96.481164563042</span>
<span class="co">#&gt; 2020-04-21,83.852700370669,96.4306054262694</span>
<span class="co">#&gt; 2020-04-22,83.1471546642847,95.6192278639274</span>
<span class="co">#&gt; 2020-04-23,82.4014298322305,94.7616443070651</span>
<span class="co">#&gt; 2020-04-24,82.1764297279875,94.5028941871856</span>
<span class="co">#&gt; 2020-04-25,81.8007613978311,94.0708756075057</span>
<span class="co">#&gt; 2020-04-26,81.0403022884185,93.1963476316813</span>
<span class="co">#&gt; 2020-04-27,80.0703485307944,92.0809008104135</span>
<span class="co">#&gt; 2020-04-28,78.3822879321543,90.1396311219774</span>
<span class="co">#&gt; 2020-04-29,76.6430719942722,88.139532793413</span>
<span class="co">#&gt; 2020-04-30,75.3139130680928,86.6110000283068</span>
<span class="co">#&gt; 2020-05-01,74.1529051109775,85.2758408776241</span>
<span class="co">#&gt; 2020-05-02,73.3223639925667,84.3207185914517</span>
<span class="co">#&gt; 2020-05-03,72.7339972989177,83.6440968937553</span></pre></body></html></div>
<p>To get fast feedback on just the User’s Prior Projection scenario, on the Internals sheet, set main.iterations to 1.</p>
<p>Save As Alameda-May4-v3.xlsx.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v3.xlsx"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-26-1.png" width="768"></p>
<ol start="7" style="list-style-type: decimal">
<li>Adjust User’s Prior Projection It looks like our prior of R0 = 3.5 is too low to match the data. Try R0 = 4. Save As Alameda-May4-v4.xlsx.</li>
</ol>
<p>It may be more convenient to plot within RStudio so we don’t have to refer to the .pdf output.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v4.xlsx"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">result</span>$<span class="no">gplot</span>$<span class="no">short.term</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-27-1.png" width="768"></p>
<p>Try fitting E0 (the initial number of exposed) using only the days before peak hospitalization. On the Interal sheet, set max.obs.date.to.fit to 4/10/2020.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">z</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v5.xlsx"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">z</span>$<span class="no">gplot</span>$<span class="no">short.term</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-28-1.png" width="768"></p>
<p>Now the beginning looks better, but then the multiplier for one of the interventions needs to be stronger. Change the first Re multiplier from 0.6 to 0.5.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">z</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v6.xlsx"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">z</span>$<span class="no">gplot</span>$<span class="no">short.term</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-29-1.png" width="768"></p>
<p>We might be getting in the ballpark. Let’s try a flatter prior distribution. Set all Priors to 20%. Set Re multiplier for the first intervention to 0.35 0.4 0.45 0.55 0.7. Set main.iterations to 10000. Set required.in.bounds to 95%.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v7.xlsx"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-31-1.png" width="768"></p>
<p>Now we at least have 40 iterations. Based on the histograms in the .pdf output, we might need a longer hospital length of stay (if you have data on this, that would be even better!). <img src="case-studies_files/figure-html/unnamed-chunk-32-1.png" width="768"><img src="case-studies_files/figure-html/unnamed-chunk-32-2.png" width="768"></p>
<p>Change Average Hospital Length of Stay to 6 10 14 18 22. Save as Alameda-May4-v8.xlsx.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v8.xlsx"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-34-1.png" width="768"></p>
<p>Now we have 115 iterations.</p>
<p>We continued this process and eventually were able to come up with priors that fit the data well. We adjusted the prior probabilities, R0, hospital length of stay, the second Re multiplier, days to reach Re, patients in hospital are infectious and constant rate to hospital.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="kw pkg">LEMMA</span><span class="kw ns">::</span><span class="fu"><a href="../reference/CredibilityIntervalFromExcel.html">CredibilityIntervalFromExcel</a></span>(<span class="st">"Alameda-May4-v9.xlsx"</span>)</pre></body></html></div>
<p><img src="case-studies_files/figure-html/unnamed-chunk-36-1.png" width="768"></p>
<p>As in “Modelling Future Changes in Transmission” above, the long term projection shows the effect of the third intervention which multiplies Re by 1.1 to 2 (C19:G19 in Alameda-May4-v9.xlsx) on June 1.</p>
<p><img src="case-studies_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
<p>This was not shown above, but another thing to try is increasing <code>upper.bound.multiplier</code> and/or decreasing <code>lower.bound.multiplier</code>. This will include combinations of parameters that give projections slightly (more) outside the given LowerBound and UpperBound.</p>
<div id="important-considerations" class="section level2">
<h2 class="hasAnchor">
<a href="#important-considerations" class="anchor"></a>Important Considerations</h2>
<p>In this case study, an important question is: how confident are we in the UpperBound of the most recent days? These are important because hospitalization appears to be declining. If we force the model to be lower than exactly UpperBound (<code>upper.bound.multiplier = 1</code>) on every day (<code>required.in.bounds = 100%</code>), projections will be more optimistic.</p>
<p>There are several reasons why it may be more prudent to use less strict bounds (above we use <code>lower.bound.multiplier = 0.95</code>; <code>upper.bound.multiplier = 1.10</code>) and to allow the projections to be outside the bounds for some days (above we use <code>required.in.bounds = 95%</code>) . For Alameda County, PUI data was not available so it is especially difficult to know the true number of COVID-19 positive. Even if PUI data were available, it is also possible that the recent decline is due to random fluctuation or reasons not captured by our model.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua Schwab.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
